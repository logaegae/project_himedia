{% extends "./blocks/layout.html" %} {% block content %}
<div class="myInfo">
    <!-- 본문 -->
    <div class="contents">
        <!-- 서브 네비 -->
        <div class="sub-navi">
            <a href="#">HOME</a><span>&gt;</span>
            <span>마이페이지</span><span>&gt;</span>
            <span class="this-page">회원정보</span>
        </div>
        <!-- // 서브 네비 -->
        <!-- 대제목 -->
        <div class="title-l">
            <div class="bg">My Page</div>
            <div class="text-box">
                <h1>회원정보</h1>
                <p>회원님의 소중한 정보입니다</p>
            </div>
        </div>
        <!-- // 대제목 -->
        <div class="tab tab-sub">
            <ul>
                <li class="on"><a href="#">회원정보</a></li>
                <li><a href="myInquiry.html">1:1 문의</a></li>
            </ul>
        </div>

        <div class="inputtable_wrap">
            <form class="input_fromwrap form1" action="changeInfo" method="post">
                <fieldset class="input_tablewrap">
                    <legend>회원가입 양식테이블입니다.</legend>
                    <table class="input_table">
                        <caption>회원가입 표입니다.</caption>
                        <colgroup>
                            <col style="width:18%">
                            <col>
                        </colgroup>
                        <tbody>
                            <tr>
                                <th>
                                    <label for="name">이름</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:20%">
                                        <input id="name" type="text" name="userName" maxlength="20" size="20" value="{{session.member.userName}}" disabled/>
                                        <input type="hidden" name="userName" value="{{session.member.userName}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label for="aksTell">연락처</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:11%">
                                        <input id="aksTell" type="text" maxlength="3" size="3" class="tel" name="tel1" value="{{session.member.userPhone.split('-')[0]}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span>-</span>
                                    <div class="input_wrap" style="width:11%">
                                        <input title="연락처 중간번호" id="aksTellmiddle" type="text" maxlength="4" size="4" class="tel" name="tel2" value="{{session.member.userPhone.split('-')[1]}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span>-</span>
                                    <div class="input_wrap" style="width:11%">
                                        <input title="연락처 마지막번호" id="aksTelllast" type="text" maxlength="4" size="4" class="tel" name="tel3" value="{{session.member.userPhone.split('-')[2]}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label for="aksTell2">핸드폰</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:11%">
                                        <input id="aksTell2" type="text" maxlength="3" class="tel" size="3" name="cell1" required value="{{session.member.userMobile.split('-')[0]}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span>-</span>
                                    <div class="input_wrap" style="width:11%">
                                        <input title="연락처 중간번호" id="aksTellmiddle2" type="text" maxlength="4" size="4" class="tel" name="cell2" required value="{{session.member.userMobile.split('-')[1]}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span>-</span>
                                    <div class="input_wrap" style="width:11%">
                                        <input title="연락처 마지막번호" id="aksTelllast2" type="text" maxlength="4" size="4" class="tel" name="cell3" required value="{{session.member.userMobile.split('-')[2]}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label for="email">이메일</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:25%">
                                        <input id="email" type="text" maxlength="20" size="20" name="email1" size="20" value="{{session.member.userEmail.split('@')[0]}}" required/>
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span>@</span>
                                    <div class="input_wrap" style="width:25%; display:none;">
                                        <input title="이메일주소 직접입력" type="text" name="email2" id="email2" value="naver.com">
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <select id="email_adress" style="vertical-align:top;" required>
                                        <option value="" disabled="disabled" selected="true" style="display:none;">이메일을 선택해 주세요.</option>
                                        <option value="naver.com">naver.com</option>
                                        <option value="nate.com">nate.com</option>
                                        <option value="gmail.com">gmail.com</option>
                                        <option value="dreamwiz.com">dreamwiz.com</option>
                                        <option value="lycos.co.kr">lycos.co.kr</option>
                                        <option value="korea.com">korea.com</option>
                                        <option value="hanmir.com">hanmir.com</option>
                                        <option value="paran.com">paran.com</option>
                                        <option value="1">직접입력</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label for="newid">아이디</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:25%">
                                        <input id="newid" type="text" name="userId" maxlength="20" size="20" value="{{session.member.userId}}" disabled/>
                                        <input type="hidden" name="userId" value="{{session.member.userId}}" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <br/>
                                    <span class="id_msg" style="color:red;"></span>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    이메일 수신
                                </th>
                                <td>
                                    <div class="radio_wrap">
                                        <input name="receiptEmailYn" id="email_yes" type="radio" value="Y">
                                        <label for="email_yes">예</label>
                                        <input name="receiptEmailYn" id="email_no" type="radio" value="N">
                                        <label for="email_no">아니요</label>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    SMS 수신
                                </th>
                                <td>
                                    <div class="radio_wrap">
                                        <input name="receiptSMSYn" id="sms_yes" type="radio" value="Y">
                                        <label for="sms_yes">예</label>
                                        <input name="receiptSMSYn" id="sms_no" type="radio" value="N">
                                        <label for="sms_no">아니요</label>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label for="newpw2">비밀번호 확인</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:30%">
                                        <input id="pw1" type="password" name="userPwd" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span class="sub_cont">정보를 수정하시려면 기존의 비밀번호를 입력해주세요.</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="btns_wrap">
                        <input class="btn1" type="submit" value="회원정보 수정하기">
                    </div>
                </fieldset>
            </form>
            <form class="input_fromwrap form2" action="changeInfo" method="post">
                <fieldset class="input_tablewrap">
                    <legend>회원가입 양식테이블입니다.</legend>
                    <table class="input_table">
                        <caption>회원가입 표입니다.</caption>
                        <colgroup>
                            <col style="width:18%">
                            <col>
                        </colgroup>
                        <tbody>
                            <tr>
                                <th>
                                    <label for="pw">기존 비밀번호</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:30%">
                                        <input id="pw2" type="password" name="userPwd" />
                                        <input type="hidden" name="userName" value="{{session.member.userName}}">
                                        <input type="hidden" name="userId" value="{{session.member.userId}}">
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label for="new_pw">새 비밀번호</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:30%">
                                        <input id="new_pw" type="password" name="newPw" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span class="sub_cont">공백 없이 영문/숫자를 조합하여 8~16자로 입력해주세요.</span>
                                </td>
                            </tr>
                            <tr>
                                <th>
                                    <label for="new_pw2">비밀번호 확인</label>
                                </th>
                                <td>
                                    <div class="input_wrap" style="width:30%">
                                        <input id="new_pw2" type="password" />
                                        <button type="button" class="input_del">삭제버튼</button>
                                    </div>
                                    <span class="sub_cont">확인을 위해 한번 더 입력해주세요.</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </fieldset>
                <div class="btns_wrap">
                    <input class="btn2" type="submit" value="비밀번호 변경하기">
                </div>
            </form>
        </div>
    </div>
    <!-- // 본문 -->
</div>
<script>
    var validate = false;
    //유효성검사
    function checkPwd(target) {
        if (!target.val()) {
            alert('비밀번호를 입력해주세요.');
            target.focus();
            return false;
        }
        $.ajax({
                method: "POST",
                url: "checkPwd",
                data: {
                    userPwd: target.val()
                }
            })
            .done(function(msg) {
                validate = !msg.isValid;
                if (validate) {
                    alertMsg('비밀번호가 맞지 않습니다.');
                    return false;
                }
            });
    }
    $('.tel').keydown(function(event) {
        var charLimit = $(this).attr("maxlength");
        var keys = [8, 9, /*16, 17, 18,*/ 19, 20, 27, 33, 34, 35, 36, 37, 38, 39, 40, 45, 46, 144, 145];
        if (event.which == 8 && this.value.length == 0) {
            $(this).parent('.input_wrap').prev().prev().find('.tel').focus();

        } else if ($.inArray(event.which, keys) >= 0) {
            return true;
        } else if (this.value.length >= charLimit) {
            $(this).parent('.input_wrap').next().next().find('.tel').focus();
            return false;
        } else if (event.shiftKey || event.which <= 47 || event.which >= 106) {
            return false;
        } else if (event.shiftKey || (event.which >= 58 && event.which <= 95)) {
            return false;
        }
    }).keyup(function() {
        var charLimit = $(this).attr("maxlength");
        if (this.value.length >= charLimit) {
            $(this).parent('.input_wrap').next().next().find('.tel').focus();
            return false;
        }
    });
    $('.btn1').click(function() {
        var emailReg = /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])/i;

        if (!emailReg.test($("#email").val())) {
            alert('이메일을 확인해주세요');
            $('#email').val('');
            $('#email').focus();
            return false;
        }
        checkPwd($('#pw1'));
        $('.form1').submit();
        return false;
    });
    $('.btn2').click(function() {
        var pwdReg1 = /^.*(?=.{6,20})(?=.*[0-9])(?=.*[a-zA-Z]).*$/;

        if (!pwdReg1.test($('#new_pw').val())) {
            alert('비밀번호는 영문,숫자를 혼합하여 \n8~16자 이내만 가능합니다');
            $('#new_pw').val('');
            $('#new_pw2').val('');
            $('#new_pw').focus();
            return false;
        }
        if ($('#new_pw').val() != $('#new_pw2').val()) {
            alert('비밀번호 확인이 잘못되었습니다');
            $('#new_pw').val('');
            $('#new_pw2').val('');
            $('#new_pw').focus();
            return false;
        }

        checkPwd($('#pw2'));
        $('.form2').submit();
        return false;
    });
    //이메일 입력방식 선택
    $('#email_adress').change(function() {
        $("#email_adress option:selected").each(function() {
            if ($(this).val() == '1') {
                $("#email2").val('').parent('.input_wrap').css('display', 'inline-block');
                $("#email2").focus();
            } else {
                $("#email2").parent('.input_wrap').css('display', 'none');
                $("#email2").attr('value', $(this).val());
            }
        });
    });
    //check
    function checkForm() {
        if('{{session.member}}'){
            var emailYn = '{{session.member.receiptEmailYn}}';
            var smsYn = '{{session.member.receiptSMSYn}}';
            var email = '{{session.member.userEmail}}'.split('@');
            var isExsist = 0;
            emailYn == "Y" ? $('#email_yes').attr('checked', 'true') : $('#email_no').attr('checked', 'true');
            smsYn == "Y" ? $('#sms_yes').attr('checked', 'true') : $('#sms_no').attr('checked', 'true');

            $('#email_adress option').each(function(i, e) {
                $(e).text() == email[1] ? isExsist = $(e) : '';
            });
            if(isExsist == 0){
                $('option[value="1"]').attr('selected', 'true');
                $('#email2').parent('.input_wrap').css('display', 'inline-block').find('#email2').attr('value', email[1]);
            }else{
                isExsist.attr('selected', 'true');
            }
        }
    }
    checkForm();
</script>
{% endblock %}
